/*!
 * Copyright (c) ZetoSoft and Basilio GermÃ¡n
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{ZetoAudioEngine:()=>z,ZetoAudioObject:()=>O,ZetoButton:()=>G,ZetoCamera:()=>M,ZetoContainer:()=>q,ZetoEasing:()=>Z,ZetoEmitter:()=>H,ZetoEngine:()=>et,ZetoEngineObject:()=>R,ZetoFill:()=>tt,ZetoGroup:()=>D,ZetoParticle:()=>it,ZetoParticleEngine:()=>W,ZetoPath:()=>k,ZetoPhysicsBody:()=>N,ZetoPhysicsEngine:()=>U,ZetoSprite:()=>J,ZetoStrings:()=>Q,ZetoTestingEngine:()=>st,ZetoTextObject:()=>j,ZetoTimerEngine:()=>_,ZetoTransition:()=>at,ZetoTransitionEngine:()=>K,ZetoWidget:()=>I,ZetoWidgets:()=>$});const i=["touchstart","touchmove","touchend","touchcancel"],s=Math.PI/180,n=180/Math.PI,r="began",h="hold",o="moved",l="ended",d="hover",u=t=>t instanceof ZetoGroup,c=t=>"function"==typeof t,p=t=>"number"==typeof t,m=t=>"string"==typeof t,g=t=>"object"==typeof t,v=()=>2*E()-1,f=Math.cos,y=Math.sin,x=Math.PI,w=.5*x,b=Math.round,S=Math.floor,E=Math.random,T=Math.max,P=(Math.sqrt,Math.abs),B=window.Matter,X=B?.Body??void 0,L=B?.Bodies??void 0,C=B?.Engine??void 0,Y=B?.Composite??void 0,A=B?.Vertices??void 0,V=B?.Events??void 0;class F{listeners={finalize:[]};dispatchEvent(t,e){if(this.listeners[t])for(var i=this.listeners[t].length;i--;)if(this.listeners[t][i](e))return!0}addEventListener(t,e){this.listeners[t]&&e&&"function"==typeof e&&this.listeners[t].push(e)}removeEventListener(t,e){if(this.listeners[t]){var i=this.listeners[t].indexOf(e);i>-1&&this.listeners[t].splice(i,1)}}hasEventListener(t,e){var i=this.listeners[t]&&this.listeners[t].length>0;return e?!!(i&&this.listeners[t].indexOf(e)>-1)&&this:!!i&&this}destroy(){for(var t in this.dispatchEvent("finalize",{target:this}),this.listeners){if(t==d&&this.hover==this.engine.frameEvent.frame){this.hover=!1;var e={x:this.mouseX,y:this.mouseY,phase:l};this.engine.dispatchObjectEvent(this,d,e)}delete this.listeners[t]}}}class O extends F{bufferSource;gainNode;audioEngine;internal={volume:1,pitch:1};listeners=["complete"];constructor(t,e,i,s,a){super(),this.audioEngine=t,this.internal.volume=i;const n=t.audioContext.createBufferSource();n.loop=a,n.buffer=e;const r=t.audioContext.createGain();r.gain.value=i*t.volume,n.connect(r).connect(t.audioContext.destination),n.onended=this.onended.bind(this),n.start(s),this.bufferSource=n,this.gainNode=r}onended(t){this.bufferSource.stop(0),this.dispatchEvent("complete",{target:this})}pause(){this.bufferSource.stop(0)}resume(){this.bufferSource.start(0)}stop(){this.bufferSource.stop(0)}syncVolume(){this.gainNode.gain.value=this.internal.volume*this.audioEngine.volume}set volume(t){this.internal.volume=t,this.syncVolume()}set pitch(t){this.internal.pitch=t,this.bufferSource.playbackRate.value=t}get volume(){return this.internal.volume}get pitch(){return this.internal.pitch}}class z{engine;volume=1;initAudioBind;audioContext;audios=[];constructor(t){this.engine=t,this.initAudioListeners()}initAudio(){try{this.audioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext,this.engine.removeEventListener("tap",this.initAudioBind),this.engine.removeEventListener("touch",this.initAudioBind),this.engine.removeEventListener("key",this.initAudioBind))}catch(t){console.error("Could not init audio context")}}initAudioListeners(){this.initAudioBind=this.initAudio.bind(this),this.engine.addEventListener("tap",this.initAudioBind),this.engine.addEventListener("touch",this.initAudioBind),this.engine.addEventListener("key",this.initAudioBind)}async play(t,e=1,i=0,s=!1,a=!1){var n=this.engine.loadedAudio[t];if(n&&this.audioContext){var r=n.audio;if(r.decoding)return;if(!r.zBuffer){r.decoding=!0;try{r.zBuffer=await this.audioContext.decodeAudioData(r.response)}catch(t){return}r.decoding=!1}e*=this.volume;var h=new O(this,r.zBuffer,e,i,s);return h.addEventListener("complete",a),h.addEventListener("complete",this.#t),this.audios.push(h),h}}#t(t){var e=t.target,i=this.audios.indexOf(e);i>-1&&this.audios.splice(i,1)}setVolume(t){this.volume=t;for(var e=0;e<this.audios.length;e++)this.audios[e].syncVolume()}}class R extends F{listeners={tap:[],touch:[],hover:[],enterframe:[],exitframe:[],finalize:[]};bounds={local:{x1:0,x2:0,y1:0,y2:0,width:0,height:0},world:{x1:0,x2:0,y1:0,y2:0,width:0,height:0,rotation:0}};worldTransform=new DOMMatrix;fillColor;alpha=1;isVisible=!0;parent;internal={x:0,y:0,width:0,height:0,anchorX:.5,anchorY:.5,anchorOffsetX:0,anchorOffsetY:0,rotation:0,xScale:1,yScale:1,xScaleInverse:1,yScaleInverse:1,fill:null};engine;strokeWidth=0;stroke;path=new ZetoPath;hover=!1;constructor(t,e,i=0,s=0){super(),this.engine=t,this.fill=e,this.x=i,this.y=s,this.fillColor=t.fillColor,this.fill&&(this.calculatePath(),this.updateBounds())}calculatePath(){this.fill.image?this.fill.sheet?this.calculateSpritePath():(this.createFillSheet(this.fill.image),this.calculateImagePath()):(this.createFillSheet(this.fill),this.path=this.fill)}calculateImagePath(){var t=this.fill.sheet.x-(this.internal.anchorX-.5)*this.bounds.local.width,e=this.fill.sheet.y-(this.internal.anchorY-.5)*this.bounds.local.height;this.path.rect(t,e,this.fill.sheet.width,this.fill.sheet.height)}calculateSpritePath(){this.path.rect(.5*-this.fill.sheet.width,.5*-this.fill.sheet.height,this.fill.sheet.width,this.fill.sheet.height)}get x(){return this.internal.x}get y(){return this.internal.y}set x(t){var e=t-this.internal.x;this.internal.x=t,this.worldTransform.translateSelf(e,0)}set y(t){var e=t-this.internal.y;this.internal.y=t,this.worldTransform.translateSelf(0,e)}get width(){return this.path.width??(this.fill?this.fill.sheet.width:0)}get height(){return this.path.height??(this.fill?this.fill.sheet.height:0)}set width(t){this.path.width=t}set height(t){this.path.height=t}set anchorX(t){this.internal.anchorX=t;var e=(t-.5)*this.bounds.local.width;if(this.body){var i=e+this.internal.anchorOffsetX;X.translate(this.body.matterBody,{x:-i,y:0}),this.body.internal.offsetX+=i}this.internal.anchorOffsetX=-e}set anchorY(t){this.internal.anchorY=t;var e=(t-.5)*this.bounds.local.height;if(this.body){var i=e+this.internal.anchorOffsetY;X.translate(this.body.matterBody,{x:0,y:-i}),this.body.internal.offsetY+=i}this.internal.anchorOffsetY=-e}get anchorX(){return this.internal.anchorX}get anchorY(){return this.internal.anchorY}set rotation(t){t!=this.internal.rotation&&(this.internal.rotation=t,this.updateBounds())}get rotation(){return this.internal.rotation}set xScale(t){t!=this.internal.xScale&&0!=t&&(this.internal.xScale=t,this.internal.xScaleInverse=1/t,this.updateBounds())}set yScale(t){t!=this.internal.yScale&&0!=t&&(this.internal.yScale=t,this.internal.yScaleInverse=1/t,this.updateBounds())}get xScale(){return this.internal.xScale}get yScale(){return this.internal.yScale}set fill(t){this.internal.fill=t,t&&t.pattern?this.createFillSheet({width:this.path.width,height:this.path.height}):t&&t.image&&!t.sheet&&this.createFillSheet(t.image)}get fill(){return this.internal.fill}setFillColor(t,e,i,s=1){this.fillColor="rgba("+t+","+e+","+i+","+s+")"}createFillSheet(t){this.fill.sheet={x:t.x??0,y:t.y??0,width:t.width??0,height:t.height??0}}draw(t,e){var i=this.internal.fill,s=this.path;if(i)if(i.pattern)t.fillStyle=i.pattern,t.scale(s.internal.xScale,s.internal.yScale),t.fill(s.path);else if(i.image){var a=i.sheet;t.drawImage(i.image,a.x,a.y,a.width,a.height,s.left,s.top,s.width,s.height)}else t.fillStyle=this.fillColor,t.scale(s.internal.xScale,s.internal.yScale),t.fill(s.path);else t.fillStyle=this.fillColor;return this.strokeWidth>0&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.stroke,t.stroke(s.path)),t}update(t){}destroy(){if(super.destroy(),this.parent){var t=this.parent.children.indexOf(this);this.parent.children.splice(t,1)}this.parent=null,this.engine=null,this.fill=null,this.path=null,this.fillColor=null}toFront(){if(this.parent){var t=this.parent.children.indexOf(this);this.parent.children.splice(t,1),this.parent.children.push(this)}}toBack(){if(this.parent){var t=this.parent.children.indexOf(this);this.parent.children.splice(t,1),this.parent.children.unshift(this)}}updateBounds(t=!1,e=!1,i=0){var a=t?this.bounds.world:this.bounds.local,n=0,r=0;t&&(n=f(this.rotation*s),r=y(this.rotation*s),a.rotation=this.rotation+i),a.x1=0,a.x2=0,a.y1=0,a.y2=0;for(var h=this.fill&&this.fill.sheet,o=this.path,l=o?.5*this.path.width:h?.5*this.fill.sheet.width:0,d=o?.5*this.path.height:h?.5*this.fill.sheet.height:0,u=[{x:-l,y:-d},{x:l,y:-d},{x:l,y:d},{x:-l,y:d}],c=0;c<u.length;c++){var p=u[c],m=t?p.x*n-p.y*r:p.x,g=t?p.x*r+p.y*n:p.y;m<a.x1&&(a.x1=m),m>a.x2&&(a.x2=m),g<a.y1&&(a.y1=g),g>a.y2&&(a.y2=g)}a.width=a.x2-a.x1,a.height=a.y2-a.y1,t||(this.internal.anchorOffsetX=-(this.anchorX-.5)*a.width,this.internal.anchorOffsetY=-(this.anchorY-.5)*a.height,e||this.updateBounds(!0,null,i))}localToContent(t,e){return{x:this.worldTransform.a*t+this.worldTransform.c*e+this.worldTransform.e,y:this.worldTransform.b*t+this.worldTransform.d*e+this.worldTransform.f}}contentToLocal(t,e){const i=this.worldTransform.inverse();return{x:i.a*t+i.c*e+i.e,y:i.b*t+i.d*e+i.f}}}class D extends R{children=[];anchorChildren=!1;constructor(t,e=0,i=0){super(t,null,e,i)}get width(){return this.bounds.local.width}get height(){return this.bounds.local.height}insert(t,e=!1){if(t.parent&&t.parent!=this){var i=t.parent.children.indexOf(t);t.parent.children.splice(i,1),t.parent.updateBounds()}return t.parent!=this&&(this.children.push(t),t.parent=this),e||this.updateBounds(),t.worldTransform=t.worldTransform.preMultiplySelf(this.worldTransform),t}updateBounds(t=!1,e=!1,i=0){if(super.updateBounds(t,e),this.children){for(var s=t?this.bounds.world:this.bounds.local,a=0;a<this.children.length;a++){var n=this.children[a];n.updateBounds(t,!0,i+this.rotation,!0);var r=t?n.bounds.world:n.bounds.local;r.x1<s.x1&&(s.x1=r.x1),r.x2>s.x2&&(s.x2=r.x2),r.y1<s.y1&&(s.y1=r.y1),r.y2>s.y2&&(s.y2=r.y2)}s.width=s.x2-s.x1,s.height=s.y2-s.y1,!t&&this.anchorChildren&&(this.internal.anchorOffsetX=-(this.anchorX-.5)*s.width,this.internal.anchorOffsetY=-(this.anchorY-.5)*s.height)}t||e||this.updateBounds(!0,null,i)}destroy(){super.destroy(),this.removeAll()}removeAll(){for(var t=this.children.length-1;t>=0;t--)this.children[t].destroy()}}class I extends D{tag;enabled=!0;constructor(t,e=0,i=0,s="default"){super(t,e,i),this.tag=s}setEnabled(t){this.enabled=t}}class k{path=new Path2D;internal={width:0,height:0,radius:0,xScale:1,yScale:1,setWidth:0,setHeight:0,setRadius:0};x=0;y=0;maxX=0;minX=0;maxY=0;minY=0;top=0;left=0;set width(t){this.internal.setWidth=t,this.internal.xScale=t/this.internal.width,this.updateBoundsWidth()}set height(t){this.internal.setHeight=t,this.internal.yScale=t/this.internal.height,this.updateBoundsHeight()}set radius(t){this.internal.setRadius=t;let e=t/this.internal.radius;this.internal.xScale=e,this.internal.yScale=e,this.updateBoundsRadius()}get width(){return this.internal.setWidth}get height(){return this.internal.setHeight}get radius(){return this.internal.setRadius}rect(t,e,i,s){return this.x=t,this.y=e,this.internal.width=i,this.internal.height=s,this.internal.setWidth=i,this.internal.setHeight=s,this.updateBoundsWidth(),this.updateBoundsHeight(),this.path.rect(t,e,i,s)}roundRect(t,e,i,s,a){return this.x=t,this.y=e,this.internal.width=i,this.internal.height=s,this.internal.radius=a,this.internal.setWidth=i,this.internal.setHeight=s,this.internal.setRadius=a,this.updateBoundsWidth(),this.updateBoundsHeight(),this.path.roundRect(t,e,i,s,a)}moveTo(t,e){return this.x=t,this.y=e,this.updateBoundsLine(),this.path.moveTo(t,e)}lineTo(t,e){return this.x=t,this.y=e,this.updateBoundsLine(),this.path.lineTo(t,e)}closePath(){return this.path.closePath()}arc(t,e,i,s,a,n){return this.x=t,this.y=e,this.internal.radius=i,this.updateBoundsRadius(),this.path.arc(t,e,i,s,a,n)}updateBoundsWidth(){var t=.5*this.internal.setWidth;this.left=-t,this.maxX=this.x+t>this.maxX?this.x+t:this.maxX,this.minX=this.x-t<this.minX?this.x-t:this.minX}updateBoundsHeight(){var t=.5*this.internal.setHeight;this.top=-t,this.maxY=this.y+t>this.maxY?this.y+t:this.maxY,this.minY=this.y-t<this.minY?this.y-t:this.minY}updateBoundsRadius(){this.maxX=this.x+this.internal.radius>this.maxX?this.x+this.internal.radius:this.maxX,this.minX=this.x-this.internal.radius<this.minX?this.x-this.internal.radius:this.minX,this.maxY=this.y+this.internal.radius>this.maxY?this.y+this.internal.radius:this.maxY,this.minY=this.y-this.internal.radius<this.minY?this.y-this.internal.radius:this.minY,this.left=this.minX,this.top=this.minY}updateBoundsLine(){this.maxX=this.x>this.maxX?this.x:this.maxX,this.minX=this.x<this.minX?this.x:this.minX,this.maxY=this.y>this.maxY?this.y:this.maxY,this.minY=this.y<this.minY?this.y:this.minY,this.left=this.minX,this.top=this.minY,this.internal.width=this.maxX-this.minX,this.internal.height=this.maxY-this.minY,this.internal.setWidth=this.internal.width,this.internal.setHeight=this.internal.height}}class j extends R{values={fontName:"Arial",fontSize:20,contextFont:"20px Arial",textString:"",width:0,words:[],lines:[],lineHeight:0,offsetY:0,spacing:0};align="center";constructor(t,e={}){super(t),this.values.fontName=e.fontName??t.defaultFontName,this.values.fontSize=e.fontSize??t.defaultFontSize,this.values.textString=String(e.text)??"",this.values.width=e.width??0,this.values.contextFont=this.values.fontSize+"px "+this.values.fontName,this.values.spacing=e.spacing??.5,this.align=e.align??"center",this.x=e.x??0,this.y=e.y??0,this.calculateTextPath(),this.updateBounds()}set fontName(t){this.values.fontName=t,this.values.contextFont=this.fontSize+"px "+this.fontName,this.calculateTextPath(!0),this.updateBounds()}get fontName(){return this.values.fontName}set fontSize(t){this.values.fontSize=t,this.values.contextFont=this.fontSize+"px "+this.fontName,this.calculateTextPath(!0),this.updateBounds()}get fontSize(){return this.values.fontSize}set text(t){t!=this.values.textString&&(this.values.textString=String(t),this.calculateTextPath(!0),this.updateBounds())}get text(){return this.values.textString}draw(t,e){super.draw(t,e),t.font=this.values.contextFont,t.fillStyle=this.fillColor;for(var i=0;i<this.values.lines.length;i++){var s=this.values.lines[i];t.fillText(s,0,this.values.offsetY+(this.values.spacing+this.values.lineHeight)*i)}return t}calculateTextPath(t=!1){var e=0,i=0;if(this.values.lines=[],this.values.width>0){e=this.values.width,this.values.words=this.values.textString.replace(/\n/g," \n ").split(/ +/);var s=0;if(this.values.lines[s]=this.values.words[0],this.values.words.length>1){for(var a=1;a<this.values.words.length;a++){var n=this.values.words[a];if("\n"!=n)if(l=""==(l=this.values.lines[s]??"")?n:l+" "+n,this.engine.context.font=this.values.contextFont,(h=this.engine.context.measureText(l)).width>this.values.width&&l!=n)s++,this.values.lines[s]=n;else i=(o=h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)>i?o:i,this.values.lines[s]=l;else s++,this.values.lines[s]=""}this.values.lineHeight=o>this.values.lineHeight?o:this.values.lineHeight}else{this.engine.context.font=this.values.contextFont,i=(h=this.engine.context.measureText(this.values.lines[s])).actualBoundingBoxAscent+h.actualBoundingBoxDescent}}else{this.values.lines=this.values.textString.split("\n");for(var r=0;r<this.values.lines.length;r++){var h,o,l=this.values.lines[r];this.engine.context.font=this.values.contextFont,(h=this.engine.context.measureText(l)).width>e&&(e=h.width),i=(o=h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)>i?o:i}}this.values.lineHeight=this.values.lines.length>1?i*(1+this.values.spacing):i;var d=this.values.lines.length*this.values.lineHeight-this.values.spacing;this.values.offsetY=-(this.values.lines.length-1)*this.values.lineHeight*.5;var u=.5*-e,c=.5*-d;t&&(this.path=new k),this.path.rect(u,c,e,d)}}class G extends I{defaultGroup;pressedGroup;disabledGroup;onTapListener;onPressListener;onReleaseListener;label;tapTimestamp=-300;holding=!1;constructor(t,e={}){super(t,e.x,e.y,e.tag),this.anchorChildren=!0,this.defaultGroup=t.newGroup(),this.defaultGroup.anchorChildren=!0,this.insert(this.defaultGroup),this.pressedGroup=t.newGroup(),this.pressedGroup.anchorChildren=!0,this.pressedGroup.isVisible=!1,this.insert(this.pressedGroup),this.disabledGroup=t.newGroup(),this.disabledGroup.anchorChildren=!0,this.disabledGroup.isVisible=!1,this.insert(this.disabledGroup),this.#e(e),this.onTapListener=e.onTap,this.onReleaseListener=e.onRelease,this.onHoldListener=e.onHold,this.onPressListener=e.onPress,this.addEventListener("tap",this.onTap.bind(this)),this.addEventListener("touch",this.onTouch.bind(this)),this.addEventListener("hover",this.onHover.bind(this)),this.addEventListener("exitframe",this.#i.bind(this))}#e(t){if(t.sheet){var e=t.sheet;2==e.numFrames||3==e.numFrames?(this.#s(this.defaultGroup,e.image,e.frameData[0]),this.#s(this.pressedGroup,e.image,e.frameData[1]),this.#s(this.disabledGroup,e.image,e.frameData[2])):6!=e.numFrames&&9!=e.numFrames||(this.#a(this.defaultGroup,e.image,t.width,e.frameData[0],e.frameData[1],e.frameData[2]),this.#a(this.pressedGroup,e.image,t.width,e.frameData[3],e.frameData[4],e.frameData[5]),this.#a(this.disabledGroup,e.image,t.width,e.frameData[6],e.frameData[7],e.frameData[8]))}else t.shape&&this.#n(t);var i={x:t.labelXOffset,y:t.labelYOffset,font:t.font,fontSize:t.fontSize,text:t.label,align:t.labelAlign};this.label=new j(this.engine,i),this.label.anchorX=t.labelAnchorX??.5,this.label.anchorY=t.labelAnchorY??.5,this.label.fillColor=t.labelColor??this.engine.fillColor,this.insert(this.label),this.updateBounds()}#n(t){const{shape:e,width:i,height:s,radius:a,fillColor:n,strokeColor:r,strokeWidth:h}=t;let o,l,d;switch(e){case"roundedRect":o=this.engine.newRoundedRect(0,0,i,s,a),l=this.engine.newRoundedRect(0,0,i,s,a),d=this.engine.newRoundedRect(0,0,i,s,a);break;case"circle":o=this.engine.newCircle(0,0,a),l=this.engine.newCircle(0,0,a),d=this.engine.newCircle(0,0,a);break;default:o=this.engine.newRect(0,0,i,s),l=this.engine.newRect(0,0,i,s),d=this.engine.newRect(0,0,i,s)}this.#r(this.defaultGroup,o,n.default,r.default,h),this.#r(this.pressedGroup,l,n.over,r.over,h),this.#r(this.disabledGroup,d,n.disabled,r.disabled,h)}#r(t,e,i,s,a){e.fillColor=i??this.fillColor,e.stroke=s??this.strokeColor,e.strokeWidth=a??2,t.insert(e)}#s(t,e,i){var s=this.engine.newRect(0,0,i.width,i.height);s.fill={image:e,sheet:i},t.insert(s)}#a(t,e,i,s,a,n){var r=s.width+n.width,h=T(i??r+a.width,r)-r,o=s.height,l=S(.5*h),d=this.engine.newRect(-l,0,s.width,o);d.anchorX=1,d.fill={image:e,sheet:s},t.insert(d);var u=this.engine.newRect(0,0,h+2,o);u.fill={image:e,sheet:a},t.insert(u);var c=this.engine.newRect(l,0,n.width,o);c.anchorX=0,c.fill={image:e,sheet:n},t.insert(c)}setLabel(t){t!=this.label.text&&(this.label.text=t)}setEnabled(t){this.enabled!=t&&(this.disabledGroup.isVisible=!t,this.defaultGroup.isVisible=t,this.pressedGroup.isVisible=!1),this.enabled=t}#i(t){this.onTapListener&&(this.engine.frameEvent.timeStamp-this.tapTimestamp<this.engine.tapTime?this.#h(!0):this.#h(!1))}#h(t){t?this.pressedGroup.isVisible||(this.pressedGroup.isVisible=!0,this.defaultGroup.isVisible=!1):this.defaultGroup.isVisible||(this.pressedGroup.isVisible=!1,this.defaultGroup.isVisible=!0)}onTap(t){if(this.enabled)return this.tapTimestamp=this.engine.frameEvent.timeStamp,this.onTapListener&&this.onTapListener(t),!0}onTouch(t){if(this.enabled)return t.phase==r?(this.onPressListener&&this.onPressListener(t),this.holding=this.engine.frameEvent.frame,this.#h(!0)):t.phase==h?(this.#h(!0),this.onHoldListener&&this.onHoldListener({target:this,frame:this.engine.frameEvent.frame-this.holding})):t.phase==l&&(this.onReleaseListener&&this.onReleaseListener(t),this.holding=!1,this.#h(!1)),!0}onHover(t){t.phase==r?this.enabled&&(document.body.style.cursor="pointer"):t.phase==l&&(document.body.style.cursor="default")}}class M extends D{targetRotation=0;focusAngle=0;rotationX=0;rotationY=0;otherRotationX=0;otherRotationY=0;finalX=0;finalY=0;values={x1:-Number.MAX_VALUE,x2:Number.MAX_VALUE,y1:-Number.MAX_VALUE,y2:Number.MAX_VALUE,damping:0,dampingMultiplier:1,defaultRotation:0,x:0,y:0,zoom:1,rotationOffset:0,trackRotation:!1,isTracking:!1};view;constructor(t,e,i){super(t,e,i),this.view=t.newGroup(),this.insert(this.view)}add(t,e){e&&(this.values.focus=t),this.view.insert(t)}set zoom(t){this.values.zoom=t,this.view.xScale=t,this.view.yScale=t}get zoom(){return this.values.zoom}set damping(t){t=t>1?1:t<0?0:t,this.values.damping=t,this.values.dampingMultiplier=1-t}get damping(){return this.values.damping}update(t){super.update(t),this.values.focus&&(this.targetRotation=this.values.trackRotation?-(this.values.focus.rotation+this.values.rotationOffset):this.values.defaultRotation,this.view.rotation=this.view.rotation-(this.view.rotation-this.targetRotation)*this.values.dampingMultiplier,this.focusAngle=this.view.rotation*s,this.values.targetX=this.values.targetX-(this.values.targetX-this.values.focus.x)*this.values.dampingMultiplier,this.values.targetY=this.values.targetY-(this.values.targetY-this.values.focus.y)*this.values.dampingMultiplier,this.values.targetX=this.values.x1<this.values.targetX?this.values.targetX:this.values.x1,this.values.targetX=this.values.x2>this.values.targetX?this.values.targetX:this.values.x2,this.values.targetY=this.values.y1<this.values.targetY?this.values.targetY:this.values.y1,this.values.targetY=this.values.y2>this.values.targetY?this.values.targetY:this.values.y2,this.otherRotationX=y(this.focusAngle)*this.values.targetY,this.rotationX=f(this.focusAngle)*this.values.targetX,this.finalX=(-this.rotationX+this.otherRotationX)*this.values.zoom,this.otherRotationY=f(this.focusAngle)*this.values.targetY,this.rotationY=y(this.focusAngle)*this.values.targetX,this.finalY=(-this.rotationY-this.otherRotationY)*this.values.zoom,this.view.x=this.finalX,this.view.y=this.finalY)}removeFocus(){this.values.focus=null}setFocus(t,e={}){var i=e.trackRotation,s=e.soft;!t||isNaN(t.x)||isNaN(t.y)||this.values.focus==t?this.values.focus=null:(this.values.focus=t,s||(this.values.targetX=t.x,this.values.targetY=t.y)),this.values.defaultRotation=0,s||(this.view.rotation=0),this.values.trackRotation=i}}class q extends R{view;get children(){return[this.view]}constructor(t,e=0,i=0,s=0,a=0){super(t,null,e,i),this.fill=new k,this.fill.rect(.5*-s,.5*-a,s,a),this.fillColor="#00000000",this.calculatePath(),this.updateBounds(),this.view=new D(t,0,0),this.view.parent=this}insert(t,e=!1){return this.view.insert(t,e)}removeAll(){this.view.removeAll()}draw(t,e){return super.draw(t,e),t.restore(),t.save(),t.beginPath(),t.rect(.5*-this.width,.5*-this.height,this.width,this.height),t.clip(),t}}class Z{static linear(t,e,i,s){return s*t/e+i}static inQuad(t,e,i,s){return s*((t/=e)*t)+i}static outQuad(t,e,i,s){return-s*(t/=e)*(t-2)+i}static inOutQuad(t,e,i,s){return(t=t/e*2)<1?s/2*(t*t)+i:-s/2*((t-1)*(t-3)-1)+i}static outBack(t,e,i,s){return s*((t=t/e-1)*t*(2.7*t+1.7)+1)+i}static inBack(t,e,i,s){return s*(t/=e)*t*(2.7*t-1.7)+i}static inOutBack(t,e,i,s){var a=2.5925;return(t=t/e*2)<1?s/2*(t*t*((a+1)*t-a))+i:s/2*((t-=2)*t*((a+1)*t+a)+2)+i}static inSine(t,e,i,s){return-s*f(t/e*w)+s+i}static outSine(t,e,i,s){return s*y(t/e*w)+i}static inOutSine(t,e,i,s){return-s/2*(f(x*t/e)-1)+i}}class W extends F{static particleTypeGravity=0;static particleTypeRadial=1;engine;emitters=[];constructor(t){super(),this.engine=t}normalize(t,e){var i=P(t.x)+P(t.y);return 0!=i?{x:e*t.x/i,y:e*t.y/i}:{x:0,y:0}}update(t){var e=.001*t.delta;if(this.emitters.length>0)for(var i=0;i<this.emitters.length;i++){var s=this.emitters[i];if("paused"!=s.state){if(s.active&&s.emissionRate>0){var a=1/s.emissionRate;for(s.particles.length<s.maxParticles&&(s.emitCounter+=e);s.particles.length<s.maxParticles&&s.emitCounter>a;)this.addParticle(s),s.emitCounter-=a;s.elapsedTime+=e,-1!=s.duration&&s.duration<s.elapsedTime&&this.stopParticleEmitter(s)}for(var n=s.particles.length-1;n>=0;n--){var r=s.particles[n];if(r.timeToLive-=e,r.timeToLive>0)this.updateParticle(s,r,e);else if(this.removeParticleAtIndex(s,n),s.particles.length<=0&&-1!=s.duration)return void this.removeEmitter({target:s})}}}}initParticle(t,e){if(e.position.x=t.sourcePositionx+t.sourcePositionVariancex*v(),e.position.y=t.sourcePositiony+t.sourcePositionVariancey*v(),e.startPos.x=t.sourcePositionx,e.startPos.y=t.sourcePositiony,e.image.parent!=t){for(var i=0,a=0,n=t;n&&n!=e.image.parent;){var r=n.rotation*s,h=f(r),o=y(r),l=i*o+a*h;i=i*h-a*o+n.x,a=l+n.y,n=n.parent}e.position.x+=i,e.position.y+=a,e.image.toBack()}var d=(t.angle+t.angleVariance*v())*s,u=f(d),c=y(d),p=t.speed+t.speedVariance*v();e.direction={x:u*p,y:c*p};var m=t.particleLifespan+t.particleLifespanVariance*v();e.timeToLive=m>0?m:0,e.radius=t.maxRadius+t.maxRadiusVariance*v(),e.radiusDelta=(e.radius-t.maxRadius)/e.timeToLive,e.angle=(t.angle+t.angleVariance*v())*s,e.degreesPerSecond=(t.rotatePerSecond+t.rotatePerSecondVariance*v())*s,e.radialAcceleration=t.radialAcceleration+t.radialAccelVariance*v(),e.tangentialAcceleration=t.tangentialAcceleration+t.tangentialAccelVariance*v();var g=t.startParticleSize+t.startParticleSizeVariance*v(),x=t.finishParticleSize+t.finishParticleSizeVariance*v();e.particleSizeDelta=(x-g)/e.timeToLive,e.particleSize=g>0?g:0;var w=t.rotationStart+t.rotationStartVariance*v(),b=t.rotationEnd+t.rotationEndVariance*v();e.rotation=w,e.rotationDelta=(b-w)/e.timeToLive,e.alpha=t.startColorAlpha+t.startColorVarianceAlpha*v();var S=t.finishColorAlpha+t.finishColorVarianceAlpha*v();e.deltaAlpha=(S-e.alpha)/e.timeToLive,e.image.x=e.position.x,e.image.y=e.position.y,e.image.rotation=e.rotation,e.image.width=e.particleSize,e.image.height=e.particleSize,e.image.alpha=e.alpha,e.image.isVisible=!0}addParticle(t){if(t.particles.length==t.maxParticles)return!1;var e=new ZetoParticle(t);return t.particles.push(e),this.initParticle(t,e),!0}stopParticleEmitter(t){t.active=!1,t.elapsedTime=0,t.emitCounter=0,t.state="stopped"}updateParticle(t,e,i){if(t.emitterType==W.particleTypeRadial)e.angle+=e.degreesPerSecond*i,e.radius+=e.radiusDelta*i,e.position.x=-f(e.angle)*e.radius,e.position.y=-y(e.angle)*e.radius;else{var s=this.normalize(e.position,1),a={x:s.x,y:s.y};s.x=s.x*e.radialAcceleration,s.y=s.y*e.radialAcceleration;var n=a.x;a.x=-a.y,a.y=n,a.x=a.x*e.tangentialAcceleration,a.y=a.y*e.tangentialAcceleration;var r={x:s.x+a.x+t.gravityx,y:s.y+a.y+t.gravityy};r.x=r.x*i,r.y=r.y*i,e.direction.x=e.direction.x+r.x,e.direction.y=e.direction.y+r.y,r.x=e.direction.x*i,r.y=e.direction.y*i,e.position.x=e.position.x+r.x,e.position.y=e.position.y+r.y}e.alpha=e.alpha+e.deltaAlpha*i,e.particleSize=e.particleSize+e.particleSizeDelta*i,e.particleSize=e.particleSize>0?e.particleSize:0,e.rotation=e.rotation+e.rotationDelta*i,e.image.x=e.position.x,e.image.y=e.position.y,e.image.rotation=e.rotation,e.image.width=e.particleSize,e.image.height=e.particleSize,e.image.alpha=e.alpha}removeParticleAtIndex(t,e){var i=t.particles[e];this.engine.remove(i.image),t.particles.splice(e,1)}removeEmitter(t){var e=t.target,i=this.emitters.indexOf(e);-1!=i&&this.emitters.splice(i,1),this.engine.remove(e)}newEmitter(t){var e=new ZetoEmitter(this.engine,t);return this.emitters.push(e),this.engine.rootGroup.insert(e,!0)}}class H extends D{particleEngine;emitterType=W.particleTypeGravity;texture;sourcePositionx=0;sourcePositiony=0;sourcePositionVariancex=0;sourcePositionVariancey=0;speed=0;speedVariance=0;particleLifespan=0;particleLifespanVariance=0;angle=0;angleVariance=0;gravityx=0;gravityy=0;radialAcceleration=0;radialAccelVariance=0;tangentialAcceleration=0;tangentialAccelVariance=0;startColorAlpha=0;startColorVarianceAlpha=0;finishColorAlpha=0;finishColorVarianceAlpha=0;maxParticles=0;startParticleSize=0;startParticleSizeVariance=0;finishParticleSize=0;finishParticleSizeVariance=0;duration=0;blendFuncSource=0;blendFuncDestination=0;maxRadius=0;maxRadiusVariance=0;minRadius=0;minRadiusVariance=0;rotatePerSecond=0;rotatePerSecondVariance=0;rotationStart=0;rotationStartVariance=0;rotationEnd=0;rotationEndVariance=0;emissionRate=0;emitCounter=0;active=!0;elapsedTime=0;absolute=!1;particles=[];state="playing";constructor(t,e){for(var i in super(t,e.x,e.y),this.particleEngine=t.particles,this.texture=t.getImageFill(e.configName),e)this[i]=e[i];this.emissionRate=this.maxParticles/this.particleLifespan}start(){this.state="playing",this.active=!0}stop(){this.active=!1,this.elapsedTime=0,this.emitCounter=0,this.state="stopped"}pause(){this.state="paused"}}class N extends F{bodyType="dynamic";shapeType;listeners={collision:[]};internal={offsetX:0,offsetY:0};path;radius;object;physics;engine;matterBody;constructor(t,e,i,s={}){super(),this.object=e,this.engine=e.engine,this.physics=t,this.bodyType=i,this.createMatterBody(s),this.createPath(),this.matterBody.isSensor=s.isSensor??!1,this.object.addEventListener("finalize",this.finalize.bind(this))}get fixedRotation(){return this.matterBody.inertia==1/0}set fixedRotation(t){this.matterBody.inertia=t?1/0:this.matterBody.inertia}set x(t){X.setPosition(this.matterBody,{x:t,y:this.matterBody.position.y},!0)}get x(){return this.matterBody.position.x}set y(t){X.setPosition(this.matterBody,{x:this.matterBody.position.x,y:t},!0)}get y(){return this.matterBody.position.y}set rotation(t){X.setAngle(this.matterBody,t*s)}get rotation(){return this.matterBody.angle*n}set isSensor(t){this.matterBody.isSensor=t}get isSensor(){return this.matterBody.isSensor}createPath(){var t=this.matterBody.vertices;this.path=new k;for(var e=this.object.x+this.object.internal.anchorOffsetX,i=this.object.y+this.object.internal.anchorOffsetY,s=0;s<t.length;s++){var a=t[s];this.path.lineTo(a.x-e,a.y-i)}this.path.closePath()}createMatterBody(t={}){var e=t.radius??!1,i=t.shape??!1,a=t.resolution??10,n=t.filter??{category:1,mask:1,group:0},r="static"==this.bodyType;this.radius=e;var h={isStatic:r,density:this.density??1,restitution:t.bounce??.1,friction:t.friction??.1,angle:this.object.rotation*s};if(i){this.shapeType="polygon",this.matterBody=L.fromVertices(0,0,i,h);var o=A.centre(i);X.translate(this.matterBody,{x:this.object.x+o.x,y:this.object.y+o.y}),this.internal.offsetX=-o.x,this.internal.offsetY=-o.y}else e?(this.shapeType="circle",this.matterBody=L.circle(this.object.x,this.object.y,e,h,a)):(this.shapeType="box",this.matterBody=L.rectangle(this.object.x,this.object.y,this.object.width,this.object.height,h));var l=this.object.internal.anchorOffsetX,d=this.object.internal.anchorOffsetY;X.translate(this.matterBody,{x:l,y:d}),this.internal.offsetX+=-l,this.internal.offsetY+=-d,this.matterBody.collisionFilter=n,this.matterBody.zBody=this,X.scale(this.matterBody,this.object.xScale,this.object.yScale)}update(t){this.object.x=this.matterBody.position.x+this.internal.offsetX,this.object.y=this.matterBody.position.y+this.internal.offsetY,this.object.rotation=this.matterBody.angle*n%360}applyForce(t,e){X.applyForce(this.matterBody,this.matterBody.position,{x:t,y:e})}setLinearVelocity(t,e){X.setVelocity(this.matterBody,{x:t,y:e})}getLinearVelocity(){return this.matterBody.velocity}applyTorque(t){this.matterBody.torque=t}getAngularVelocity(){return this.matterBody.angularVelocity}setAngularVelocity(t){X.setAngularVelocity(this.matterBody,t)}setMass(t){X.setMass(this.matterBody,t)}getMass(){return this.matterBody.mass}finalize(t){Y.remove(this.physics.matterWorld,this.matterBody)}}class U extends F{paused=!0;debugColor="#FF880077";matterEngine;matterWorld;engine;bodies=[];maxDelta=1e3/30;listeners={collision:[]};constructor(t){super(),this.engine=t;try{this.matterEngine=C.create({positionIterations:2,velocityIterations:2,constraintIterations:1}),this.matterWorld=this.matterEngine.world,this.collisionBind=this.collision.bind(this),V.on(this.matterEngine,"collisionStart",this.collisionBind),V.on(this.matterEngine,"collisionEnd",this.collisionBind)}catch(t){console.warn("Matter.js not found, physics engine is disabled")}}collision(t){for(var e=t.pairs,i=0;i<e.length;i++){var s=e[i],a=s.bodyA,n=s.bodyB,h=a.zBody,o=n.zBody,d="collisionStart"==t.name?r:l,u=s.contacts.find((t=>null!=t)),c={x:u.vertex.x,y:u.vertex.y,phase:d,target:h,other:o,collision:s.collision,pair:s};h.hasEventListener("collision")&&h.dispatchEvent("collision",c),o.hasEventListener("collision")&&(c.target=o,c.other=h,o.dispatchEvent("collision",c)),this.dispatchEvent("collision",c)}}update(t){if(!this.paused){for(var e=0;e<this.bodies.length;e++){this.bodies[e].update(t)}var i=t.delta>this.maxDelta?this.maxDelta:t.delta;C.update(this.matterEngine,i)}}debugDraw(t,e){t.scale(e.object.internal.xScaleInverse,e.object.internal.yScaleInverse),t.lineWidth=1,t.fillStyle=e.debugColor??this.debugColor,t.fill(e.path.path)}addBody(t,e,i){t.body=new N(this,t,e,i),Y.add(this.matterWorld,t.body.matterBody),this.bodies.push(t.body)}removeBody(t){t.removeEventListener("finalize",t.body.finalize),Y.remove(this.matterWorld,t.body.matterBody)}setGravity(t,e){this.matterEngine.gravity.x=t,this.matterEngine.gravity.y=e}start(){this.paused=!1}pause(){this.paused=!0}stop(){this.paused=!0}}class K extends F{engine;transitions=[];constructor(t){super(),this.engine=t}#o(t,e){if(null!=t)if(c(t))t(e);else if(a instanceof Array)for(var i=0;i<t.length;i++)c(t[i])&&t[i](e)}update(t){for(var e=this.transitions.length-1;e>=0;e--){var i=this.transitions[e];if(i.remove)this.transitions.splice(e,1),i.target.transitions.splice(i.target.transitions.indexOf(i),1);else if(i.delay>0&&i.currentDelay<i.delay)i.currentDelay+=t.delta,i.currentDelay>=i.delay&&(i.currentDelay=i.delay);else if(i.time>0&&i.currentTime<i.time)for(var s in i.currentTime<=0&&this.#o(i.onStart,i.target),i.currentTime+=t.delta,i.currentTime>=i.time&&(i.currentTime=i.time),i.targetValues){null!=i.targetObjects[s]&&(i.targetValues[s]=i.targetObjects[s][s],i.deltaValues[s]=i.targetValues[s]-i.startValues[s]);var a=i.easing(i.currentTime,i.time,i.startValues[s],i.deltaValues[s]);i.target[s]=i.stringFlags[s]?parseInt(a):a}else{for(var s in i.targetValues)i.target[s]=i.targetValues[s];this.#o(i.onComplete,i.target),i.remove=!0}}}to(t,e={}){var i={};for(var s in e)"delay"!=s&&"time"!=s&&"easing"!=s&&"onStart"!=s&&"onComplete"!=s&&(i[s]=e[s]);var a=new ZetoTransition(t,e.delay,e.time,e.easing,e.onStart,e.onComplete,i);return this.transitions.push(a),t.transitions||(t.transitions=[]),t.transitions.push(a),a}from(t,e={}){var i={},s={};for(var a in e)"delay"!=a&&"time"!=a&&"easing"!=a&&"onStart"!=a&&"onComplete"!=a&&(i[a]=e[a],s[a]=t[a]);var n=new ZetoTransition(t,e.delay,e.time,e.easing,e.onStart,e.onComplete,s,i);return this.transitions.push(n),t.transitions||(t.transitions=[]),t.transitions.push(n),n}cancel(t){if(t instanceof ZetoTransition)t.remove=!0;else if(t.transitions)for(var e=t.transitions.length-1;e>=0;e--){t.transitions[e].remove=!0}}}class _{engine;timers=[];constructor(t){this.engine=t}update(t){for(var e=this.timers.length-1;e>=0;e--){var i=this.timers[e];i.remove?this.timers.splice(e,1):i.currentDelay>0&&(0!=i.iterations?(i.currentDelay-=t.delta,i.currentDelay<=0&&(i.listener({target:i}),i.iterations--,i.currentDelay+=i.delay)):0==i.iterations&&this.timers.splice(e,1))}}performWithDelay(t,e,i=1){if(!e||"function"!=typeof e)throw new Error("Invalid listener");var s={delay:t,listener:e,iterations:i,currentDelay:t,delay:t,remove:!1};return this.timers.push(s),s}cancel(t){t&&(t.remove=!0)}}class $ extends F{widgets={default:[]};enabled={default:!0};engine;listeners={enabled:[]};#l;constructor(t){super(),this.engine=t,this.#l=this.#d.bind(this)}newButton(t){let e=new G(this.engine,t);e.addEventListener("finalize",this.#l);let i=t.tag??"default";return this.widgets[i]=this.widgets[i]??[],this.widgets[i].push(e),this.enabled[i]=this.enabled[i]??!0,e.setEnabled(this.enabled[i]),this.engine.rootGroup.insert(e,!0)}#d(t){let e=t.target.tag,i=this.widgets[e].indexOf(t.target);i>-1&&this.widgets[e].splice(i,1)}setEnabled(t,e="default"){this.enabled[e]=t,this.widgets[e]=this.widgets[e]??[];for(var i=0;i<this.widgets[e].length;i++){this.widgets[e][i].setEnabled(t)}this.dispatchEvent("enabled",{target:this,enabled:t,tag:e})}}class Q extends F{strings=[{en:{}},{es:{}}];engine;locale="en";listeners={locale:[]};constructor(t){super(),this.engine=t}setLocale(t){this.locale=t,this.dispatchEvent("locale",{target:this,locale:t})}add(t){for(var e in t)for(var i in this.strings[e]||(this.strings[e]={}),t[e])this.strings[e][i]=t[e][i]}get(t,e){let i=this.strings[this.locale][t]||t;return e&&"object"==typeof e&&Object.keys(e).forEach((t=>{const s=`:${t}`,a=e[t];i=i.replace(new RegExp(s,"g"),a)})),i}}class J extends R{imageSheet;sequenceData;sequenceMap={};frame=0;frameTime=0;frameTimestamp=0;sequence=!1;playing=!1;constructor(t,e,i,s=0,a=0){super(t,e,s,a),this.imageSheet=e,this.sequenceData=i,this.sequenceData.forEach((t=>{this.sequenceMap[t.name]=t}))}setSequence(t){this.sequenceMap[t]&&(this.sequence=this.sequenceMap[t],this.frameTime=this.sequence.time/this.sequence.count)}play(){this.playing=!0}stop(){this.playing=!1}update(t){if(super.update(t),this.playing&&this.sequence){0==this.frameTimestamp&&(this.frameTimestamp=t.timeStamp);var e=t.timeStamp-this.frameTimestamp,i=mathFloor(e/this.frameTime);if(i>0){if(this.sequence.count>1&&this.sequence.time>0){this.frame+=i,this.frameTimestamp=t.timeStamp-e%this.frameTime;var s=this.sequence.start+this.sequence.count-1;if(this.frame>s){var a=(this.frame-s)%this.sequence.count-1;this.frame=this.sequence.start+a}else if(this.frame<this.sequence.start){a=(this.sequence.start-this.frame)%this.sequence.count;this.frame=this.sequence.start+this.sequence.count-a}}var n=this.imageSheet.frameData[this.frame];n&&n!=this.fill.sheet&&(this.fill.sheet=n)}}}}class tt{pattern;matrix;internal={x:0,y:0,xScale:1,yScale:1,rotation:0,width:0,height:0};constructor(t,e,i){this.pattern=t,this.matrix=new DOMMatrix,this.pattern.setTransform(this.matrix),this.internal.width=e,this.internal.height=i,this.x=.5*e,this.y=.5*i}set width(t){this.x=.5*t,this.xScale=t/this.internal.width}set height(t){this.y=.5*t,this.yScale=t/this.internal.height}get width(){return this.internal.width*this.internal.xScale}get height(){return this.internal.height*this.internal.yScale}set x(t){var e=t-this.internal.x;this.matrix.translateSelf(e,0),this.pattern.setTransform(this.matrix),this.internal.x=t}set y(t){var e=t-this.internal.y;this.matrix.translateSelf(0,e),this.pattern.setTransform(this.matrix),this.internal.y=t}set xScale(t){var e=t/this.internal.xScale;this.matrix.scaleSelf(e,1),this.pattern.setTransform(this.matrix),this.internal.xScale=t}set yScale(t){var e=t/this.internal.yScale;this.matrix.scaleSelf(1,e),this.pattern.setTransform(this.matrix),this.internal.yScale=t}set rotation(t){var e=t-this.internal.rotation;this.matrix.rotateSelf(e*n),this.pattern.setTransform(this.matrix),this.internal.rotation=t}get x(){return this.internal.x}get y(){return this.internal.y}get xScale(){return this.internal.xScale}get yScale(){return this.internal.yScale}get rotation(){return this.internal.rotation}}class et extends F{debug=!1;listeners={enterframe:[],exitframe:[],resize:[],touch:[],wheel:[],tap:[],key:[]};mouseX=0;mouseY=0;mouseTouch=!1;holdingKey={};tapTime=200;touchPoints=[];removeTouchPoints=[];activeTouchPoints=[];rootGroup;loadedModules={};loadedImages={};loadedAudio={};loadedData={};fillColor="white";clearColor="black";clearAlpha=1;debugTapColor="#FF00FFBB";debugBoundsColor="#FF0000BB";debugColor="#FFFFFFBB";defaultFontName="Arial";defaultFontSize=20;frameEvent={frame:0,timeStamp:0,delta:0};canvasLocked=!1;canvas;context;audioContext;cX;cY;width;height;paused=!1;focus=!0;pauseBind;showFPS=!1;secondsPassed;oldTimeStamp;fps;physics;particles;timer;transition;widgets;strings;info={isMobile:(255&navigator.maxTouchPoints)>1||"ontouchstart"in document};loadedIds={image:{},audio:{},data:{},unknown:{}};constructor(t={}){super();var e=t.moduleName??!1,i=t.moduleParams??{},s=t.loadedListener??!1,a=t.progressListener??!1,n=t.smoothing??!1,r=t.canvas??"canvas";this.rootGroup=new D(this),this.physics=new U(this),this.particles=new W(this),this.transition=new K(this),this.timer=new _(this),this.widgets=new $(this),this.strings=new Q(this),this.audio=new z(this),document.addEventListener("touchstart",{}),window.addEventListener("visibilitychange",this.visibilityChange.bind(this)),window.addEventListener("touchstart",this.touchStart.bind(this),{passive:!1}),window.addEventListener("touchmove",this.touchMove.bind(this),{passive:!1}),window.addEventListener("touchend",this.touchEnd.bind(this),{passive:!1}),window.addEventListener("touchcancel",this.touchCancel.bind(this),{passive:!1}),window.addEventListener("mousedown",this.mouseDown.bind(this)),window.addEventListener("mousemove",this.mouseMove.bind(this)),window.addEventListener("mouseup",this.mouseUp.bind(this)),window.addEventListener("wheel",this.wheelEvent.bind(this)),window.addEventListener("keydown",this.keyDown.bind(this)),window.addEventListener("keyup",this.keyUp.bind(this)),this.initCanvas(n,r),window.onunload=function(t){t.preventDefault()},e&&this.load(e,i,s,a)}visibilityChange(t){document.hidden&&(this.focus=!1)}touchStart(t){t.preventDefault();for(var e=t.changedTouches?.length>0?t.changedTouches:[t],i=0;i<e.length;i++){var s=e[i];this.touchPoints[s.identifier]||(this.activeTouchPoints.push(s.identifier),this.touchPoints[s.identifier]={lastInputX:s.pageX,lastInputY:s.pageY,startX:s.pageX,startY:s.pageY,startTime:t.timeStamp,startFrame:this.frameEvent.frame,listenerObjects:[],state:1})}}inputTouch(t){for(var e=t.changedTouches?.length>0?t.changedTouches:[t],i=0;i<e.length;i++){var s=e[i],a=this.touchPoints[s.identifier??0],n=s.pageX-a.lastInputX,r=s.pageY-a.lastInputY;a.lastInputX=s.pageX,a.lastInputY=s.pageY;var h={deltaX:n,deltaY:r,touchPoint:a,phase:o},l=!1;if(a.listenerObjects.length>0)for(var d=0;d<a.listenerObjects.length;d++){var u=a.listenerObjects[d];if(u.hasEventListener("touch")){h={x:a.lastInputX,y:a.lastInputY,deltaX:n,deltaY:r,touchPoint:a,phase:o};if(l=1==this.dispatchObjectEvent(u,"touch",h))break}}l||this.dispatchEvent("touch",h)}}touchMove(t){t.preventDefault(),this.inputTouch(t)}touchEnd(t){t.preventDefault();for(var e=t.changedTouches?.length>0?t.changedTouches:[t],i=0;i<e.length;i++){var s=e[i],a=s.identifier??0,n=this.touchPoints[a];n.lastInputX=s.pageX,n.lastInputY=s.pageY;var r=t.timeStamp-n.startTime,h=!1;r<this.tapTime&&(h={x:n.lastInputX,y:n.lastInputY,time:r});var o={x:n.lastInputX,y:n.lastInputY,touchPoint:n,phase:l},d=!1,u=!1;if(n.listenerObjects.length>0)for(var c=0;c<n.listenerObjects.length;c++){var p=n.listenerObjects[c];if(h&&p.hasEventListener("tap")&&!u&&(u=1==this.dispatchObjectEvent(p,"tap",h)),p.hasEventListener("touch")&&!d&&(d=1==this.dispatchObjectEvent(p,"touch",o)),d&&u)break}d||this.dispatchEvent("touch",o),h&&!u&&this.dispatchEvent("tap",h),this.removeTouchPoints.push(a),n.listenerObjects=!1}}touchCancel(t){this.touchEnd(t)}mouseDown(t){0==t.button&&(this.mouseTouch=!0,this.activeTouchPoints.push(0),this.touchPoints[0]={lastInputX:t.pageX,lastInputY:t.pageY,startX:t.pageX,startY:t.pageY,startTime:t.timeStamp,startFrame:this.frameEvent.frame,listenerObjects:[],state:1})}mouseMove(t){this.mouseTouch&&this.inputTouch(t),this.mouseX=t.pageX,this.mouseY=t.pageY}mouseUp(t){0==t.button&&(this.mouseTouch=!1,this.touchEnd(t))}wheelEvent(t){var e={deltaX:t.wheelDeltaX,deltaY:t.wheelDeltaY};this.dispatchEvent("wheel",e)}inputKey(t,e,i=0){var s={phase:e,key:t.key,code:t.code,shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,altKey:t.altKey,frame:i};this.dispatchEvent("key",s)}keyDown(t){this.inputKey(t,r),this.holdingKey[t.code??t.key]={event:t,frame:0}}keyUp(t){this.inputKey(t,l,-1),this.holdingKey[t.code??t.key]=!1}initCanvas(t=!1,e="canvas"){this.canvas=document.getElementById(e),this.context=canvas.getContext("2d"),this.resizeCanvas(),this.context.mozImageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.msImageSmoothingEnabled=t,this.context.imageSmoothingEnabled=t,canvas.style.outline="none",canvas.style.webkitTapHighlightColor="rgba(255, 255, 255, 0)",canvas.style.webkitTouchCallout="none",canvas.style.webkitUserSelect="none",canvas.style.khtmlUserSelect="none",canvas.style.mozUserSelect="none",canvas.style.msUserSelect="none",canvas.style.userSelect="none",document.documentElement.style.overscrollBehavior="none",document.body.style.overscrollBehavior="none",window.addEventListener("resize",this.resizeCanvas.bind(this),!1),window.requestAnimationFrame(this.mainLoop.bind(this))}mainLoop(t){this.focus||(this.focus=!0,this.frameEvent.timeStamp=t),this.frameEvent.frame++,this.paused?(this.frameEvent.delta=0,this.frameEvent.timeStamp=t):(this.frameEvent.delta=t-this.frameEvent.timeStamp,this.frameEvent.timeStamp=t),this.dispatchEvent("enterframe",this.frameEvent),this.clearCanvas(),this.updateInput(),this.drawUpdate(this.context,this.rootGroup),this.updateTouchPoints(),this.paused||(this.timer.update(this.frameEvent),this.transition.update(this.frameEvent),this.physics.update(this.frameEvent),this.particles.update(this.frameEvent)),this.dispatchEvent("exitframe",this.frameEvent),this.showFPS&&this.drawFPS(t),window.requestAnimationFrame(this.mainLoop.bind(this))}updateTouchPoints(){for(var t=this.removeTouchPoints.length-1;t>=0;t--){var e=this.removeTouchPoints[t],i=this.activeTouchPoints.indexOf(e);i>-1&&this.activeTouchPoints.splice(i,1),delete this.touchPoints[e],this.removeTouchPoints.splice(t,1)}for(t=0;t<this.activeTouchPoints.length;t++){var s=this.touchPoints[this.activeTouchPoints[t]],a=1==s.state?r:h,n={x:s.lastInputX,y:s.lastInputY,touchPoint:s,phase:a},o=!1;if(s.listenerObjects.length>0)for(var l=0;l<s.listenerObjects.length;l++){var d=s.listenerObjects[l];d.hasEventListener("touch")&&(o=1==this.dispatchObjectEvent(d,"touch",n))}o?s.state=2:(this.dispatchEvent("touch",n),s.state=2)}}drawFPS(t){this.secondsPassed=(t-this.oldTimeStamp)/1e3,this.oldTimeStamp=t,this.fps=b(1/this.secondsPassed),this.context.font="25px Arial",this.context.fillStyle=this.fillColor,this.context.fillText("FPS: "+this.fps,60,30)}clearCanvas(){this.context.fillStyle=this.clearColor,this.context.globalAlpha=this.clearAlpha,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}updateInput(){for(var t in this.holdingKey){var e=this.holdingKey[t];e&&(e.frame>0&&this.inputKey(e.event,h,e.frame),e.frame++)}}updatePhysics(t){this.physics.update(t)}touchUpdate(t,e,i=!1){if(this.activeTouchPoints.length<=0)return!1;var s=e.hasEventListener("tap")||e.hasEventListener("touch");if(u(e))return s||i;for(var a=0;a<this.activeTouchPoints.length;a++){var n=this.touchPoints[this.activeTouchPoints[a]];this.frameEvent.frame>n.startFrame+1||n.listenerObjects&&(s||i)&&t.isPointInPath(e.path.path,n.lastInputX,n.lastInputY)&&(i&&(-1==n.listenerObjects.indexOf(i)&&n.listenerObjects.push(i),i=!1),s&&(n.listenerObjects.push(e),s=!1))}return s||i}hoverUpdate(t,e,i=!1){var s=e.hasEventListener(d)||i;if(s){if(s.hover){if(!(s.hover==this.frameEvent.frame||s.isVisible&&0!=s.alpha&&t.isPointInPath(e.path.path,this.mouseX,this.mouseY))){s.hover=!1;a={x:this.mouseX,y:this.mouseY,phase:l};this.dispatchObjectEvent(s,d,a)}}else if(t.isPointInPath(e.path.path,this.mouseX,this.mouseY)){s.hover=this.frameEvent.frame;var a={x:this.mouseX,y:this.mouseY,phase:r};this.dispatchObjectEvent(s,d,a)}return s}}debugDraw(t,e){if(this.debug){t.globalAlpha=1,t.lineWidth=1,t.fillStyle=this.debugColor,u(e)?(t.save(),t.rotate(45*s),t.fillRect(0,-4,2,10),t.fillRect(-4,0,10,2),t.restore()):(t.fillRect(-1.5,-1.5,3,3),e.bounds&&(t.strokeStyle=this.debugBoundsColor,t.save(),t.rotate(-e.bounds.world.rotation*s),t.strokeRect(e.bounds.world.x1,e.bounds.world.y1,e.bounds.world.width,e.bounds.world.height),t.restore())),t.strokeStyle=this.debugColor;for(var i=0;i<this.activeTouchPoints.length;i++){var a=this.touchPoints[this.activeTouchPoints[i]];if(a.listenerObjects&&a.listenerObjects.indexOf(e)>-1){t.strokeStyle=this.debugTapColor,t.fillText("Touching",0,0);break}}t.stroke(e.path.path),e.body&&this.physics.debugDraw(t,e.body)}}drawUpdateChildren(t,e,i=1,s,a){if(e.children&&e.children.length>0)for(var n=0;n<e.children.length;n++)this.drawUpdate(t,e.children[n],i,s,a)}dispatchObjectEvent(t,e,i){var s={...i};return s.target=t,t.dispatchEvent(e,s)}drawUpdate(t,e,i=1,a=!1,n=!1){if(t.save(),t.translate(e.x,e.y),t.rotate(e.rotation*s),t.scale(e.xScale,e.yScale),e.worldTransform=t.getTransform(),this.dispatchObjectEvent(e,"enterframe",this.frameEvent),e.update(this.frameEvent),e.isVisible){t.globalAlpha=i*e.alpha,t.translate(e.internal.anchorOffsetX,e.internal.anchorOffsetY);var r=e.draw(t,this.frameEvent);a=this.touchUpdate(r,e,a),n=this.hoverUpdate(r,e,n);this.drawUpdateChildren(r,e,t.globalAlpha,a,n)}this.debugDraw(t,e),t.restore(),this.dispatchObjectEvent(e,"exitframe",this.frameEvent)}resizeCanvas(t){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.cX=.5*this.canvas.width,this.cY=.5*this.canvas.height,this.width=this.canvas.width,this.height=this.canvas.height,this.context.textBaseline="middle",this.context.textAlign="center";var e={width:this.canvas.width,height:this.canvas.height,cX:this.cX,cY:this.cY};this.dispatchEvent("resize",e)}newGroup(t,e){var i=new D(this,t,e);return this.rootGroup.insert(i,!0)}newContainer(t,e,i,s){var a=new q(this,t,e,i,s);return this.rootGroup.insert(a,!0)}newCamera(t,e){var i=new ZetoCamera(this,t,e);return this.rootGroup.insert(i,!0)}newText(t){var e=new j(this,t);return this.rootGroup.insert(e,!0)}newImage(t,e,i){var s=this.loadedImages[t];if(s)return this.newImageRect(t,e,i,s.image.width,s.image.height);throw new Error("Image not loaded: "+t)}newImageRect(t,e,i,s,a){var n=this.loadedImages[t];if(n){s=s??n.image.width,a=a??n.image.height;var r=this.newRect(e,i,s,a);return r.fill={image:n.image,sheet:{x:0,y:0,width:n.image.width,height:n.image.height}},this.rootGroup.insert(r,!0)}throw new Error("Image not loaded: "+t)}newCircle(t,e,i){var s=new k;s.arc(0,0,i,0,2*x,!1);var a=new R(this,s,t,e);return this.rootGroup.insert(a,!0)}newRoundedRect(t,e,i,s,a){var n=new k;n.roundRect(.5*-i,.5*-s,i,s,a);var r=new R(this,n,t,e);return this.rootGroup.insert(r,!0)}newRect(t,e,i,s){var a=new k;a.rect(.5*-i,.5*-s,i,s);var n=new R(this,a,t,e);return this.rootGroup.insert(n,!0)}newPolygon(t,e,i){for(var s=new k,a=0;a<i.length;a++){var n=i[a];0==a?s.moveTo(n.x,n.y):s.lineTo(n.x,n.y)}s.closePath();var r=new R(this,s,t,e);return this.rootGroup.insert(r,!0)}newImageSheet(t,e){var i=e.frames??[],s=i.length,a=this.loadedImages[t];if(!e.frames){var n=e.width,r=e.height;s=e.numFrames;for(var h=S(a.image.width/e.width),o=0;o<s;o++){var l=o%h,d=S(o/h);i.push({x:l*n,y:d*r,width:n,height:r})}}return{image:a.image,frameData:i,numFrames:s,sheet:i[0]}}newSprite(t,e,i=0,s=0){var a=new J(this,t,e,i,s);return this.rootGroup.insert(a,!0)}getImageFill(t,e,i="repeat"){var s=this.loadedImages[t];if(s&&e){var a=this.context.createPattern(s.image,i);return new tt(a,s.image.width,s.image.height)}return s}getData(t){if(this.loadedData[t])return this.loadedData[t].data.response}remove(t){t&&t.destroy&&t.destroy()}getAsset(t,e){return"image"==t?!!this.loadedImages[e]&&this.loadedImages[e].image:"audio"==t?!!this.loadedAudio[e]&&this.loadedAudio[e].audio:"data"==t?!!this.loadedData[e]&&this.loadedData[e].data:void 0}loadAssets(t,e,i,s,a){var n=0;n+=t?t.length:0,n+=e?e.length:0,n+=i?i.length:0;var r=0;var h=function(t){var e=t.target,i=e.zType??"unknown";if(this.loadedIds[i][e.id]){this.getAsset(i,e.id)!=e&&console.warn("Duplicate "+i+"."+e.id+" with different contents")}if(this.loadedIds[i][e.id]=t.type??!0,r++,a){var h={numLoaded:r,numAssets:n,loadedId:e.id,progress:r/n,asset:e};a(h)}r==n&&s({numLoaded:r})}.bind(this);(t&&t.forEach((t=>{this.#u(t.id,t.filename,"image",h)||(t.image=new Image,t.image.onload=h,t.image.src=t.filename,t.image.id=t.id,t.image.zType="image",this.loadedImages[t.id]=t,t.image.complete&&h({target:t.image,type:"cache-z"}))})),e&&e.forEach((t=>{this.#u(t.id,t.filename,"audio",h)||(t.audio=new XMLHttpRequest,t.audio.onload=h,t.audio.open("GET",t.filename,!0),t.audio.responseType="arraybuffer",t.audio.id=t.id,t.audio.send(),t.audio.zType="audio",this.loadedAudio[t.id]=t)})),i&&i.forEach((t=>{this.#u(t.id,t.filename,"data",h)||(t.data=new XMLHttpRequest,t.data.onload=h,t.data.open("GET",t.filename,!0),t.data.responseType="json",t.data.id=t.id,t.data.send(),t.data.zType="data",this.loadedData[t.id]=t)})),0==n)&&s({numLoaded:0,engine:this})}#u(t,e,i,s){if(this.loadedIds[i][t]){var a="image"==i?this.loadedImages[t]:"audio"==i?this.loadedAudio[t]:this.loadedData[t];return a.filename==e&&(s({target:a[i],type:"cachez"}),!0)}return!1}#c(t){return function(e){return function(i){return i.result=!!e&&e(i),!!t&&t(i)}}}async load(t,e,i,s){var a=t.replace(/\./g,"/");const n=this.loadedModules[t]??await import(`./${a}.js?c=${Date.now()}`);this.loadedModules[t]=n;var r={params:e,engine:this,complete:this.#c(i),progress:this.#c(s),phase:"create"};return n.create(r),n}async unload(t,e,i){var s=t.replace(/\./g,"/");const a=this.loadedModules[t]??await import(`./${s}.js`);this.loadedModules[t]=a;var n={params:e,engine:this,complete:i,phase:"destroy"};a.destroy(n)}pause(){this.paused=!0}resume(){this.paused=!1,this.hasEventListener("exitframe",this.pauseBind)&&this.removeEventListener("exitframe",this.pauseBind)}step(){this.pauseBind=this.pauseBind?this.pauseBind:this.pause.bind(this),this.hasEventListener("exitframe",this.pauseBind)||this.addEventListener("exitframe",this.pauseBind),this.paused=!this.paused}getInfo(t){return this.info[t]}setFullscreen(t){t?this.canvas.requestFullscreen?this.canvas.requestFullscreen():this.canvas.webkitRequestFullscreen?this.canvas.webkitRequestFullscreen():this.canvas.msRequestFullscreen&&this.canvas.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}#p(t){t.preventDefault()}setCanvasLock(t){if(this.canvasLocked=t,t)for(var e=0;e<i.length;e++)this.canvas.addEventListener(i[e],this.#p);else for(e=0;e<i.length;e++)this.canvas.removeEventListener(i[e],this.#p)}}class it{image;position={x:0,y:0};direction={x:0,y:0};startPos={x:0,y:0};startAlpha=0;endAlpha=0;deltaAlpha=0;rotation=0;rotationDelta=0;radialAcceleration=0;tangentialAcceleration=0;radius=0;radiusDelta=0;angle=0;degreesPerSecond=0;particleSize=0;particleSizeDelta=0;timeToLive=0;constructor(t){var e=t.engine;this.image=e.newImage(t.texture.id,0,0),this.image.isVisible=!1;var i=t;1==t.absolutePosition?i=t.parent:u(t.absolutePosition)&&(i=t.absolutePosition),i.insert(this.image,!0)}}class st{engine;physics;assertCount;disabled=!1;filter=!1;constructor(t={}){t.disabled?this.disabled=!0:(this.filter=t.filter??!1,this.engine=new et,this.physics=this.engine.physics,this.engine.paused=!0)}test(t,e){if(!(this.disabled||this.filter&&-1==t.indexOf(this.filter))){this.assertCount=0;try{e(),console.log("Test passed: "+t+" ("+this.assertCount+" assertions)")}catch(e){console.error("Test failed: "+t,e)}}}assert(t,e,i){if(this.assertCount++,t!=e)throw new Error("Error asserting that "+t+" equals "+e+", checking "+i)}}class at{id;target;easing;targetValues={};targetObjects={};startValues={};deltaValues={};stringFlags={};onComplete;onStart;delay;time;currentDelay=0;currentTime=0;remove=!1;constructor(t,e=0,i=300,s=null,a=null,n=null,r=null,h=null){for(var o in this.target=t,this.easing=s,this.onComplete=n,this.onStart=a,this.delay=e,this.time=i,this.easing||(this.easing=Z.linear),r){var l=r[o];g(l)?(this.startValues[o]=h?h[o]:t[o],this.targetObjects[o]=l,this.targetValues[o]=l[o]):m(l)?(this.stringFlags[o]=!0,this.startValues[o]=h?parseInt(h[o]):parseInt(t[o]),this.targetValues[o]=parseInt(l)):p(l)&&(this.startValues[o]=h?h[o]:t[o],this.targetValues[o]=l),this.deltaValues[o]=this.targetValues[o]-this.startValues[o],h&&null!=h[o]&&(t[o]=h[o])}}}var nt=window;for(var rt in e)nt[rt]=e[rt];e.__esModule&&Object.defineProperty(nt,"__esModule",{value:!0})})();